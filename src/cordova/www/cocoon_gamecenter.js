!function(){window.cordova&&"undefined"!=typeof require&&require("cocoon-plugin-social-common.Social");var e=window.Cocoon;e.define("Cocoon.Social",function(n){function t(n){return new e.Social.User(n.playerID,n.alias)}function i(n){return new e.Social.Achievement(n.identifier,n.title,n.achievedDescription,"",n.maximumPoints)}return n.GameCenterExtension=function(){return this.serviceName="LDGameCenterPlugin",this.onGameCenterLoginStateChanged=new e.Signal,this.on=this.onGameCenterLoginStateChanged.expose(),document.addEventListener("deviceready",function(){this.init()}.bind(this)),this},n.GameCenterExtension.prototype={_currentPlayer:null,init:function(){var n=this;e.exec(this.serviceName,"setListener",[],function(e){n._currentPlayer=e,n.onGameCenterLoginStateChanged.emit("loginStatusChanged",null,[e])})},getSocialInterface:function(){return this._socialService||(this._socialService=new e.Social.SocialGamingServiceGameCenter(this)),this._socialService},getMultiplayerInterface:function(){return e.Multiplayer.GameCenter},isLoggedIn:function(){return this._currentPlayer&&this._currentPlayer.isAuthenticated},login:function(n){var t=this;e.exec(this.serviceName,"login",[],function(e){t._currentPlayer=e,n&&n(e,null)},function(e){t._currentPlayer=e[0],n&&n(t._currentPlayer,e[1])})},getLocalPlayer:function(){return this._currentPlayer},loadPlayers:function(n,t){e.exec(this.serviceName,"loadPlayers",[n],function(e){t(e,null)},function(e){t(null,e)})},loadFriends:function(n){e.exec(this.serviceName,"loadFriends",[],function(e){n(e,null)},function(e){n(null,e)})},loadAchievements:function(n){e.exec(this.serviceName,"loadAchievements",[],function(e){n(e||[],null)},function(e){n(null,e)})},loadAchievementDescriptions:function(n){e.exec(this.serviceName,"loadAchievementDescriptions",[],function(e){n(e||[],null)},function(e){n(null,e)})},loadScores:function(n,t){e.exec(this.serviceName,"loadScores",[t],function(e){n(e||[],null)},function(e){n(null,e)})},submitScore:function(n,t){e.exec(this.serviceName,"submitScore",[n],function(){t()},function(e){t(e)})},submitAchievements:function(n,t){e.exec(this.serviceName,"submitAchievements",[n],function(){t()},function(e){t(e)})},resetAchievements:function(n){e.exec(this.serviceName,"resetAchievements",[],function(){n()},function(e){n(e)})},showAchievements:function(n){e.exec(this.serviceName,"showAchievements",[],function(){n()},function(e){n(e)})},showLeaderboards:function(n,t){e.exec(this.serviceName,"showLeaderboards",[t],function(){n()},function(e){n(e)})}},n.GameCenter=new n.GameCenterExtension,n.GameCenter.Player=function(){this.playerID="",this.alias="",this.isFriend=!1},n.GameCenter.LocalPlayer=function(){this.playerID="",this.alias="",this.isAuthenticated=!1},n.GameCenter.Achievement=function(e,n){this.identifier=e,this.percentComplete=n,this.lastReportedDate=0},n.GameCenter.AchievementDescription=function(){this.identifier="",this.title="",this.achievedDescription="",this.unachievedDescription="",this.maximumPoints=0},n.GameCenter.Score=function(e,n,t,i,c,r){return this.userID=e,this.score=n||0,this.userName=t,this.imageURL=i,this.leaderboardID=c,this.rank=r.rank,this.originalScoreObject=r,this},n.GameCenter.Leaderboard=function(e,n,t,i,c,r){this.category=e,this.playerIDs=n,this.timeScope=t,this.playerScope=i,this.rangeStart=c,this.rangeLength=r,this.scores=[],this.localPlayerScore=[],this.localizedTitle=localizedTitle},n.GameCenter.TimeScope={TODAY:0,WEEK:1,ALL_TIME:2},n.GameCenter.PlayerScope={GLOBAL:0,FRIENDS:1},n.SocialGamingServiceGameCenter=function(n){e.Social.SocialGamingServiceGameCenter.superclass.constructor.call(this),this.gc=n;var t=this;this.gc.on("loginStatusChanged",function(e,n){t.onLoginStatusChanged.emit("loginStatusChanged",null,[e&&e.isAuthenticated,n])})},n.SocialGamingServiceGameCenter.prototype={_cachedAchievements:null,isLoggedIn:function(){return this.gc.isLoggedIn()},login:function(e){this.gc.login(function(n,t){e&&e(n&&n.isAuthenticated,t)})},logout:function(e){e&&e({message:"User has to logout from the Game Center APP"})},getLoggedInUser:function(){return t(this.gc._currentPlayer?this.gc._currentPlayer:this.gc.getLocalPlayer())},requestUser:function(e,n){if(n)this.gc.loadPlayers([n],function(n,i){var c=n&&n.length?t(n[0]):null;e(c,i)});else{var i=this;setTimeout(function(){e(i.getLoggedInUser())})}},requestFriends:function(e,n){this.gc.loadFriends(function(n,i){var c=[];if(n&&n.length)for(var r=0;r<n.length;++r)c.push(t(n[r]));e(c,i)})},requestScore:function(n,t){var i={},c=t||{};c.leaderboardID&&(i.category=c.leaderboardID),i.playerIDs=[c.userID||this.getLoggedInUser().userID],this.gc.loadScores(function(t,i){var r=null;c.userID&&t&&t.scores&&t.scores.length?r=t.scores[0]:t&&t.localPlayerScore&&(r=t.localPlayerScore);var o=r?new e.Social.Score(r.playerID,r.value,"","",r.category,r):null;n(o,i)},i)},submitScore:function(e,n,t){var i=t||{};this.gc.submitScore({value:e,category:i.leaderboardID||""},function(e){n&&n(e)})},showLeaderboard:function(e,n){var t=n||{};this.gc.showLeaderboards(function(n){e&&e(n)},{category:t.leaderboardID||""})},prepareAchievements:function(e,n){if(!this._cachedAchievements||e){var t=this;this.gc.loadAchievementDescriptions(function(e,c){if(c)n([],c);else{var r=[];if(e&&e.length)for(var o=0;o<e.length;o++)r.push(i(e[o]));t.setCachedAchievements(r),n(r,null)}})}else n(this._cachedAchievements,null)},requestAllAchievements:function(e){this.prepareAchievements(!0,e)},requestAchievements:function(e,n){var t=this;this.prepareAchievements(!1,function(n,i){return i?void e([],i):void t.gc.loadAchievements(function(n,i){if(i)e([],n.error);else{var c=[];if(n&&n.length)for(var r=0;r<n.length;r++){var o=t.findAchievement(n[r].identifier);o&&c.push(o)}e(c,null)}})})},submitAchievement:function(e,n){if(null===e||"undefined"==typeof e)throw"No achievementID specified";var t=this.translateAchievementID(e);this.gc.submitAchievements([{identifier:t,percentComplete:100}],n)},resetAchievements:function(e){this.gc.resetAchievements(e)},showAchievements:function(e){this.gc.showAchievements(function(n){e&&e(n)})}},e.extend(n.SocialGamingServiceGameCenter,n.SocialGamingService),n})}();