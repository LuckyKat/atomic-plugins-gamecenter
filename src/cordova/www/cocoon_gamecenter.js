!function(){window.cordova&&"undefined"!=typeof require&&cordova.require("com.ludei.social.common.Social");var e=window.Cocoon;e.define("Cocoon.Social",function(t){function i(t){return new e.Social.User(t.playerID,t.alias)}function n(t){return new e.Social.Achievement(t.identifier,t.title,t.achievedDescription,"",t.maximumPoints)}return t.GameCenterExtension=function(){return this.serviceName="LDGameCenterPlugin",this.onGameCenterLoginStateChanged=new e.Signal,this.on=this.onGameCenterLoginStateChanged.expose(),document.addEventListener("deviceready",function(){this.init()}.bind(this)),this},t.GameCenterExtension.prototype={_currentPlayer:null,init:function(){var t=this;e.exec(this.serviceName,"setListener",[],function(e){t._currentPlayer=e,t.onGameCenterLoginStateChanged.emit("loginStatusChanged",[e])})},getSocialInterface:function(){return this._socialService||(this._socialService=new e.Social.SocialGamingServiceGameCenter(this)),this._socialService},getMultiplayerInterface:function(){return e.Multiplayer.GameCenter},isLoggedIn:function(){return this._currentPlayer&&this._currentPlayer.isAuthenticated},login:function(t){var i=this;e.exec(this.serviceName,"login",[],function(e){i._currentPlayer=e,t&&t(e,null)},function(e){i._currentPlayer=e[0],t&&t(i._currentPlayer,e[1])})},getLocalPlayer:function(){return this._currentPlayer},loadPlayers:function(t,i){e.exec(this.serviceName,"loadPlayers",[t],function(e){i(e,null)},function(e){i(null,e)})},loadFriends:function(t){e.exec(this.serviceName,"loadFriends",[],function(e){t(e,null)},function(e){t(null,e)})},loadAchievements:function(t){e.exec(this.serviceName,"loadAchievements",[],function(e){t(e||[],null)},function(e){t(null,e)})},loadAchievementDescriptions:function(t){e.exec(this.serviceName,"loadAchievementDescriptions",[],function(e){t(e||[],null)},function(e){t(null,e)})},loadScores:function(t,i){e.exec(this.serviceName,"loadScores",[i],function(e){t(e||[],null)},function(e){t(null,e)})},submitScore:function(t,i){e.exec(this.serviceName,"submitScore",[t],function(){i()},function(e){i(e)})},submitAchievements:function(t,i){e.exec(this.serviceName,"submitAchievements",[t],function(){i()},function(e){i(e)})},resetAchievements:function(t){e.exec(this.serviceName,"resetAchievements",[],function(){t()},function(e){t(e)})},showAchievements:function(t){e.exec(this.serviceName,"showAchievements",[],function(){t()},function(e){t(e)})},showLeaderboards:function(t,i){e.exec(this.serviceName,"showLeaderboards",[i],function(){t()},function(e){t(e)})}},t.GameCenter=new t.GameCenterExtension,t.GameCenter.Player=function(){this.playerID="",this.alias="",this.isFriend=!1},t.GameCenter.LocalPlayer=function(){this.playerID="",this.alias="",this.isAuthenticated=!1},t.GameCenter.Achievement=function(e,t){this.identifier=e,this.percentComplete=t,this.lastReportedDate=0},t.GameCenter.AchievementDescription=function(){this.identifier="",this.title="",this.achievedDescription="",this.unachievedDescription="",this.maximumPoints=0},t.GameCenter.Score=function(e,t,i,n,c,r){return this.userID=e,this.score=t||0,this.userName=i,this.imageURL=n,this.leaderboardID=c,this.rank=r.rank,this.originalScoreObject=r,this},t.GameCenter.Leaderboard=function(e,t,i,n,c,r){this.category=e,this.playerIDs=t,this.timeScope=i,this.playerScope=n,this.rangeStart=c,this.rangeLength=r,this.scores=[],this.localPlayerScore=[],this.localizedTitle=localizedTitle},t.GameCenter.TimeScope={TODAY:0,WEEK:1,ALL_TIME:2},t.GameCenter.PlayerScope={GLOBAL:0,FRIENDS:1},t.SocialGamingServiceGameCenter=function(t){e.Social.SocialGamingServiceGameCenter.superclass.constructor.call(this),this.gc=t;var i=this;this.gc.on("loginStatusChanged",function(e,t){i.onLoginStatusChanged.emit("loginStatusChanged",[e&&e.isAuthenticated,t])})},t.SocialGamingServiceGameCenter.prototype={_cachedAchievements:null,isLoggedIn:function(){return this.gc.isLoggedIn()},login:function(e){this.gc.login(function(t,i){e&&e(t&&t.isAuthenticated,i)})},logout:function(e){e&&e({message:"User has to logout from the Game Center APP"})},getLoggedInUser:function(){return i(this.gc._currentPlayer?this.gc._currentPlayer:this.gc.getLocalPlayer())},requestUser:function(e,t){if(t)this.gc.loadPlayers([t],function(t,n){var c=t&&t.length?i(t[0]):null;e(c,n)});else{var n=this;setTimeout(function(){e(n.getLoggedInUser())})}},requestFriends:function(e,t){this.gc.loadFriends(function(t,n){var c=[];if(t&&t.length)for(var r=0;r<t.length;++r)c.push(i(t[r]));e(c,n)})},requestScore:function(t,i){var n={},c=i||{};c.leaderboardID&&(n.category=c.leaderboardID),n.playerIDs=[c.userID||this.getLoggedInUser().userID],this.gc.loadScores(function(i,n){var r=null;c.userID&&i&&i.scores&&i.scores.length?r=i.scores[0]:i&&i.localPlayerScore&&(r=i.localPlayerScore);var o=r?new e.Social.Score(r.playerID,r.value,"","",r.category,r):null;t(o,n)},n)},submitScore:function(e,t,i){var n=i||{};this.gc.submitScore({value:e,category:n.leaderboardID||""},function(e){t&&t(e)})},showLeaderboard:function(e,t){var i=t||{};this.gc.showLeaderboards(function(t){e&&e(t)},{category:i.leaderboardID||""})},prepareAchievements:function(e,t){if(!this._cachedAchievements||e){var i=this;this.gc.loadAchievementDescriptions(function(e,c){if(c)t([],c);else{var r=[];if(e&&e.length)for(var o=0;o<e.length;o++)r.push(n(e[o]));i.setCachedAchievements(r),t(r,null)}})}else t(this._cachedAchievements,null)},requestAllAchievements:function(e){this.prepareAchievements(!0,e)},requestAchievements:function(e,t){var i=this;this.prepareAchievements(!1,function(t,n){return n?void e([],n):void i.gc.loadAchievements(function(t,n){if(n)e([],t.error);else{var c=[];if(t&&t.length)for(var r=0;r<t.length;r++){var o=i.findAchievement(t[r].identifier);o&&c.push(o)}e(c,null)}})})},submitAchievement:function(e,t){if(null===e||"undefined"==typeof e)throw"No achievementID specified";var i=this.translateAchievementID(e);this.gc.submitAchievements([{identifier:i,percentComplete:100}],t)},resetAchievements:function(e){this.gc.resetAchievements(e)},showAchievements:function(e){this.gc.showAchievements(function(t){e&&e(t)})}},e.extend(t.SocialGamingServiceGameCenter,t.SocialGamingService),t})}();